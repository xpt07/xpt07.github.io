<!doctype html>
<html lang="en">
<head>
    <title>Path Tracer — GuiCodes</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Interactive CPU-based Path Tracer with BVH, MIS, and Denoising">
    <link rel="shortcut icon" href="../assets/images/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="../assets/icons/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/plugins/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/plugins/css/animate.css">
    <link rel="stylesheet" href="../assets/plugins/css/owl.css">
    <link rel="stylesheet" href="../assets/plugins/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <link rel="stylesheet" href="../assets/css/colors/purple.css" title="purple">
</head>
<body class="dark-vertion black-bg">

    <header class="black-bg mh-header mh-fixed-nav nav-scroll mh-xs-mobile-nav">
        <div class="overlay"></div>
        <div class="container">
            <nav class="navbar navbar-expand-lg mh-nav nav-btn">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar">
                    <span class="navbar-toggler-icon icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar">
                    <ul class="navbar-nav mr-auto ml-auto">
                        <li class="nav-item"><a class="nav-link" href="../index.html#mh-home">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="../index.html#mh-portfolio">Portfolio</a></li>
                        <li class="nav-item"><a class="nav-link" href="../index.html#mh-contact">Contact</a></li>
                    </ul>
                    <a class="btn btn-fill" href="../index.html#mh-portfolio"><i class="fa fa-arrow-left"></i> Back to Portfolio</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="project-hero mh-home" id="mh-home" style="background: url('../assets/images/portfolio/afterTD-clipped.png') center/cover no-repeat;">
        <div class="container">
            <div class="row section-separator vertical-middle-content home-padding">
                <div class="col-sm-8">
                    <div class="mh-header-info">
                        <div class="mh-promo wow fadeInUp"><span>Project</span></div>
                        <h2 class="wow fadeInUp">Interactive Path Tracer</h2>
                        <h4 class="wow fadeInUp">Realistic CPU Rendering with BVH, MIS & Denoising</h4>
                        <div class="mh-meta wow fadeInUp">
                            <span class="badge-tech">C++</span>
                            <span class="badge-tech">Path Tracing</span>
                            <span class="badge-tech">DirectX</span>
                            <span class="badge-tech">Multithreading</span>
                            <span class="badge-tech">OIDN</span>
                            <span class="badge-tech">BVH</span>
                            <span class="badge-tech">MIS</span>
                        </div>
                    </div>
                </div>
                <div class="col-sm-4 text-center">
                    <img src="../assets/images/portfolio/cornell-box-PT.png" alt="Ray tracer preview" class="img-fluid rounded">
                </div>
            </div>
        </div>
    </section>

    <main class="mh-about" id="content">
        <div class="container">
            <div class="row section-separator">
                <div class="col-md-8">
                    <div class="mh-about-inner">
                        <h3 class="mh-section-title">Overview</h3>
                        <p>This project extends a CPU-based ray tracer into a full-featured Monte Carlo path tracer. Key additions include multithreaded tile-based rendering, environment lighting with multiple importance sampling (MIS), physically-based glass materials, denoising using Intel’s OIDN, and light tracing. The aim was to improve both physical accuracy and render performance. Although not all features were fully realized (e.g., GGX BRDF and instant radiosity), the final renderer achieves notable image quality and interactive performance.</p>
                        <h3 class="mh-section-title">Technical Breakdown</h3>

                        <h4>1. Code Structure</h4>
                        <p>The project is structured modularly across separate components: scene loading, materials, acceleration structures, integrators, and sampling. Integrators follow a shared interface for extensibility. Rendering backends can be swapped easily, and the BSDF system supports layer stacking (diffuse + specular + transmission). All geometry is stored in a global triangle buffer using pretransformed vertex data.</p>

                        <h4>2. BVH Acceleration Structure</h4>
                        <p>A binary BVH (Bounding Volume Hierarchy) is constructed recursively by splitting primitives along the longest axis of their bounding box. The split point is the median of centroids. Construction halts at a max depth or when a node contains 6 or fewer triangles. During traversal, rays perform top-down AABB intersection checks:</p>
                        <pre><code class="language-cpp">if (ray.intersects(node.bounds)) {
    if (node.isLeaf()) {
        checkTriangles(node);
    } else {
        traverse(node.left);
        traverse(node.right);
    }
}</code></pre>
                        <p>This yields dramatic improvements over brute-force intersection (up to 20×), especially for large scenes like Sponza.</p>

                        <h4>3. Möller–Trumbore Intersection</h4>
                        <p>For ray-triangle intersection, the Möller–Trumbore algorithm was used for its speed and precision. Backface culling is disabled for two-sided materials.</p>

                        <h4>4. Multi-threaded Tile-Based Rendering</h4>
                        <p>The renderer is parallelized using a thread pool and atomic tile queue. The image is divided into fixed-size tiles (e.g. 32×32), and each worker pulls a tile job atomically. This leads to effective load balancing and near-linear scaling on 8–12 core CPUs. OpenMP was avoided in favour of manual control.</p>

                        <h4>5. Environment Lighting & Importance Sampling</h4>
                        <p>Environment maps are sampled using a 2D importance sampling strategy based on the luminance of texels × sin(θ), where θ is latitude. A cumulative distribution function (CDF) is precomputed for both marginal and conditional axes (rows and columns):</p>
<pre><code class="language-cpp">// Convert envmap to CDFs
for (int y = 0; y &lt; H; ++y) {
    for (int x = 0; x &lt; W; ++x) {
        luminance[y][x] *= sin(pi * (y + 0.5) / H);
    }
}
// build 2D CDF from this luminance map
</code></pre>
                        <p>Sampling is done via binary search on the marginal CDF (rows), then conditional CDF (columns). This allows focusing samples toward bright regions like sun discs or light poles.</p>

                        <h4>6. Multiple Importance Sampling (MIS)</h4>
                        <p>MIS blends the probability of BSDF sampling with light sampling using the balance heuristic:</p>
                        <pre><code class="language-cpp">weight = lightPdf / (lightPdf + bsdfPdf);</code></pre>
                        <p>This reduces variance and bright fireflies caused by mismatched PDFs. It’s especially important when sampling glossy surfaces under point or environment lights.</p>
                        <div class="row">
                            <div class="col-md-6">
                                <img src="../assets/images/portfolio/beforeTD.png" class="img-fluid rounded mb-3">
                                <p class="text-center">Without MIS</p>
                            </div>
                            <div class="col-md-6">
                                <img src="../assets/images/portfolio/afterTD.png" class="img-fluid rounded mb-3">
                                <p class="text-center">With MIS + CDF</p>
                            </div>
                        </div>

                        <h4>7. Light Tracing</h4>
                        <p>To better simulate caustics and light paths from small emitters, a unidirectional light tracing strategy was implemented. Light rays are spawned from emissive surfaces (including environment map) and traced toward the camera. A film importance function is used to weight samples by sensor relevance:</p>
                        <pre><code class="language-cpp">float we = 1 / (filmArea * pow(cosTheta, 4));</code></pre>
                        <p>Only rays that land near the film center contribute significantly. This approach captures indirect light paths that standard path tracing misses, such as specular-diffuse-specular chains.</p>
                        <img src="../assets/images/portfolio/LTstairs.jpg" class="img-fluid rounded mb-3">

                        <h4>8. Adaptive Sampling (Experimental)</h4>
                        <p>A variance-based adaptive sampling system was tested, where high-noise tiles would receive additional samples. However, variance estimates were unstable at low spp, and managing per-tile buffers introduced threading overhead. It remains disabled by default but is modular.</p>
                        <h4>9. Layered BSDFs & Glass Transmission</h4>
                        <p>The BSDF system supports layered materials where diffuse, specular, and transmission components are combined. This allows creation of complex surfaces like plastic, coated metal, and glass. The glass model is physically based, obeying Fresnel reflection and Snell’s Law:</p>
                        <pre><code class="language-cpp">float fresnel = FresnelDielectric(cosTheta, etaI, etaT);
if (rand &lt; fresnel) {
    // Reflect ray
} else {
    // Refract ray using Snell's law
}</code></pre>
                        <p>Since reflection/refraction are delta events, their PDFs are zero except at sampled directions. This makes MIS difficult, so heuristic weight is set to 1 when matching samples, 0 otherwise.</p>
                        <img src="../assets/images/portfolio/glass.png" class="img-fluid rounded mb-3" alt="Glass with Caustics">

                        <h4>10. Denoising with Intel OIDN</h4>
                        <p>The renderer integrates Intel’s Open Image Denoise library (OIDN) to reduce noise while preserving edge sharpness and detail. Auxiliary buffers like normal and albedo are passed into the denoiser to improve quality. The filter is applied after accumulation using the following pipeline:</p>
                        <ol>
                            <li>Each render sample contributes to radiance, normal, and albedo buffers</li>
                            <li>After rendering, OIDN processes the image using all three</li>
                            <li>Final denoised image is saved as EXR and PNG</li>
                        </ol>
                        <div class="row">
                            <div class="col-md-6">
                                <img src="../assets/images/portfolio/noD.png" class="img-fluid rounded mb-3">
                                <p class="text-center">Before</p>
                            </div>
                            <div class="col-md-6">
                                <img src="../assets/images/portfolio/yesD.png" class="img-fluid rounded mb-3">
                                <p class="text-center">After OIDN</p>
                            </div>
                        </div>

                        <h4>11. Evaluation Results</h4>
                        <p>The renderer was tested on multiple complex scenes, including the Sponza Atrium and Cornell Box with caustics and environment lighting. With 4096 samples per pixel and 8–12 threads, interactive performance was achieved with real-time tile previews. OIDN produced clean output at 2–4× fewer samples. MIS and light tracing significantly improved convergence time and quality.</p>
                        <img src="../assets/images/portfolio/sponza.png" class="img-fluid rounded mb-3" alt="Sponza with Environment Lighting">
                        <img src="../assets/images/portfolio/causticMirror.png" class="img-fluid rounded mb-3" alt="Mirror Caustics in Cornell Box">

                        <h4 class="mh-section-title">12. Limitations & Future Work</h4>
                        <ul>
                            <li>Microfacet GGX BRDF is not yet implemented</li>
                            <li>Instant Radiosity and photon mapping were explored but not integrated</li>
                            <li>Specular-diffuse-specular chains are poorly handled without bidirectional techniques</li>
                            <li>No explicit Russian roulette path termination (instead capped max depth)</li>
                        </ul>
                        <p>In future, these could be addressed via BDPT (bidirectional path tracing), advanced BRDFs, and temporal reuse strategies.</p>

                        <h4 class="mh-section-title">How to Run</h4>
                        <ol>
                            <li>Clone the repo: <code>git clone https://github.com/xpt07/RTBase.git</code></li>
                            <li>Open in Visual Studio (Release x64)</li>
                            <li>Run with command-line args: <code>-scene cornell -spp 2048</code></li>
                            <li>Controls: <kbd>WASD</kbd> to move, <kbd>E/Q</kbd> to ascend/descend, <kbd>P</kbd> to save</li>
                        </ol>

                        <a class="btn btn-fill mt-3" href="https://github.com/xpt07/RTBase" target="_blank">
                            <i class="fa fa-github"></i> View Code on GitHub
                        </a>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-md-4">
                    <div class="mh-about-inner">
                        <h3 class="mh-section-title">Project Info</h3>
                        <ul class="mh-experience-deatils">
                            <li><i class="fa fa-user"></i> Individual Project</li>
                            <li><i class="fa fa-calendar"></i> 2025</li>
                            <li><i class="fa fa-code"></i> C++, DirectX, OIDN</li>
                            <li><i class="fa fa-cogs"></i> BVH, MIS, PBR</li>
                        </ul>

                        <h3 class="mh-section-title">Screenshots</h3>
                        <a href="../assets/images/portfolio/cornell-box-PT.png" data-fancybox="gallery">
                            <img src="../assets/images/portfolio/cornell-box-PT.png" class="img-fluid rounded mb-3">
                        </a>
                        <a href="../assets/images/portfolio/afterTD-clipped.png" data-fancybox="gallery">
                            <img src="../assets/images/portfolio/afterTD-clipped.png" class="img-fluid rounded mb-3">
                        </a>
                        <a href="../assets/images/portfolio/sponza.png" data-fancybox="gallery">
                            <img src="../assets/images/portfolio/sponza.png" class="img-fluid rounded mb-3">
                        </a>
                        <a href="../assets/images/portfolio/causticMirror.png" data-fancybox="gallery">
                            <img src="../assets/images/portfolio/causticMirror.png" class="img-fluid rounded mb-3">
                        </a>
                        <a href="../assets/images/portfolio/glass.png" data-fancybox="gallery">
                            <img src="../assets/images/portfolio/glass.png" class="img-fluid rounded mb-3">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../assets/plugins/js/jquery.min.js"></script>
    <script src="../assets/plugins/js/popper.min.js"></script>
    <script src="../assets/plugins/js/bootstrap.min.js"></script>
    <script src="../assets/plugins/js/waypoints.min.js"></script>
    <script src="../assets/plugins/js/owl.carousel.min.js"></script>
    <script src="../assets/plugins/js/jquery.filterizr.min.js"></script>
    <script src="../assets/plugins/js/jquery.fancybox.min.js"></script>
    <script src="../assets/plugins/js/wow.min.js"></script>
    <script src="../assets/js/custom-scripts.js"></script>
    <script>new WOW().init();</script>

</body>
</html>
